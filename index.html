<html>
<meta charset="UTF-8"/>
<script src="//cdnjs.cloudflare.com/ajax/libs/dropbox.js/0.10.2/dropbox.min.js"></script>
<script type="text/javascript" src="/elm-runtime.js"></script>
<script type="text/javascript" src="build/Main.js"></script>
<style>
.selected {
  border: 1px solid blue;
  background: #99f;
}
.cursor {
  width: 0px;
  overflow: visible;
  position: relative;
  left: -0.3em;
  top: 0.7em;
  display: inline-block;
  color: red;
}
</style>
<body></body>
<script>
var runningElmModule = Elm.fullscreen(Elm.Main, {
  downsIn: 0,
  dropboxIn: "",
  metaIn: 0
});

// ---- DROPBOX

var client = new Dropbox.Client({ key: "mjplyqeks6z3js8" });

client.authenticate(function(error, client) {
  if (error) {
    return alert(error);
  }
  console.log("Dropbox is authorized");
  client.readFile("outlin.json", function(error, data) {
    if (error) {
      return alert(error);
    }
    console.log("Read outlin.json from Dropbox");
    runningElmModule.ports.dropboxIn.send(data);
  });

  var writeToken = null;
  runningElmModule.ports.dropboxOut.subscribe(function(json) {
    console.log("Got " + json.slice(0, 100));
    if (writeToken) clearTimeout(writeToken);
    writeToken = setTimeout(function() {
      client.writeFile("outlin.json", json, function(error, stat) {
        if (error) {
          return alert(error);
        }
        console.log("outlin.json saved as revision " + stat.versionTag);
      });
    }, 5000);
  });
});

</script>
</html>